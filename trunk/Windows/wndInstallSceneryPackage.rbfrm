#tag WindowBegin Window wndInstallSceneryPackage   BackColor       =   &hFFFFFF   Backdrop        =   ""   CloseButton     =   True   Composite       =   True   Frame           =   0   FullScreen      =   False   HasBackColor    =   False   Height          =   1.11e+3   ImplicitInstance=   True   LiveResize      =   True   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   False   MaxWidth        =   793   MenuBar         =   ""   MenuBarVisible  =   True   MinHeight       =   600   MinimizeButton  =   True   MinWidth        =   793   Placement       =   0   Resizeable      =   True   Title           =   "#kWindowTitle"   Visible         =   True   Width           =   793   Begin PushButton PushButton2      AutoDeactivate  =   True      Bold            =   ""      ButtonStyle     =   0      Cancel          =   ""      Caption         =   "Test .org Login"      Default         =   ""      Enabled         =   True      Height          =   28      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   132      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   False      Scope           =   0      TabIndex        =   8      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   857      Underline       =   ""      Visible         =   True      Width           =   139   End   Begin TextField txtUsername      AcceptTabs      =   ""      Alignment       =   0      AutoDeactivate  =   True      AutomaticallyCheckSpelling=   False      BackColor       =   &hFFFFFF      Bold            =   ""      Border          =   True      CueText         =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Format          =   ""      Height          =   22      HelpTag         =   ""      Index           =   -2147483648      Italic          =   ""      Left            =   132      LimitText       =   0      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   False      Mask            =   ""      Password        =   ""      ReadOnly        =   ""      Scope           =   0      TabIndex        =   9      TabPanelIndex   =   0      TabStop         =   True      Text            =   ""      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   789      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   139   End   Begin Label StaticText4      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   21      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   20      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   False      Multiline       =   ""      Scope           =   0      Selectable      =   False      TabIndex        =   10      TabPanelIndex   =   0      Text            =   "User name:"      TextAlign       =   2      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   789      Transparent     =   False      Underline       =   ""      Visible         =   True      Width           =   100   End   Begin Label StaticText5      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   21      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   20      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   False      Multiline       =   ""      Scope           =   0      Selectable      =   False      TabIndex        =   11      TabPanelIndex   =   0      Text            =   "Password:"      TextAlign       =   2      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   822      Transparent     =   False      Underline       =   ""      Visible         =   True      Width           =   100   End   Begin TextField txtPassword      AcceptTabs      =   ""      Alignment       =   0      AutoDeactivate  =   True      AutomaticallyCheckSpelling=   False      BackColor       =   &hFFFFFF      Bold            =   ""      Border          =   True      CueText         =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Format          =   ""      Height          =   22      HelpTag         =   ""      Index           =   -2147483648      Italic          =   ""      Left            =   132      LimitText       =   0      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   False      Mask            =   ""      Password        =   ""      ReadOnly        =   ""      Scope           =   0      TabIndex        =   12      TabPanelIndex   =   0      TabStop         =   True      Text            =   ""      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   822      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   139   End   Begin HTTPSocket loginSocket      Address         =   ""      BytesAvailable  =   ""      BytesLeftToSend =   ""      Height          =   32      Index           =   -2147483648      InitialParent   =   ""      IsConnected     =   0      Left            =   823      LockedInPosition=   False      Port            =   80      Scope           =   0      TabPanelIndex   =   0      Top             =   0      Width           =   32      yield           =   0   End   Begin HTMLViewer loginHTMLViewer      AutoDeactivate  =   True      Enabled         =   True      Height          =   188      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   20      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   False      Scope           =   0      TabIndex        =   0      TabIndex        =   0      TabPanelIndex   =   0      TabStop         =   True      Top             =   902      Visible         =   True      Width           =   753   End   Begin CheckBox chkRememberLogin      AutoDeactivate  =   True      Bold            =   ""      Caption         =   "Remember"      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   21      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   282      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   False      Scope           =   0      State           =   0      TabIndex        =   13      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   823      Underline       =   ""      Value           =   False      Visible         =   True      Width           =   100   End   Begin TabPanel TabPanel1      AutoDeactivate  =   True      Bold            =   ""      Enabled         =   True      Height          =   722      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   20      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      Panels          =   ""      Scope           =   0      SmallTabs       =   False      TabDefinition   =   "#kOnlineTextSearch\r#kOnlineLocationSearch\r#kLocalZipInstall"      TabIndex        =   14      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   14      Underline       =   ""      Value           =   0      Visible         =   True      Width           =   753      Begin TextField txtAptCode         AcceptTabs      =   ""         Alignment       =   0         AutoDeactivate  =   True         AutomaticallyCheckSpelling=   False         BackColor       =   &hFFFFFF         Bold            =   ""         Border          =   True         CueText         =   ""         DataField       =   ""         DataSource      =   ""         Enabled         =   True         Format          =   ""         Height          =   22         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         Italic          =   ""         Left            =   167         LimitText       =   0         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   True         Mask            =   ""         Password        =   ""         ReadOnly        =   ""         Scope           =   0         TabIndex        =   0         TabPanelIndex   =   1         TabStop         =   True         Text            =   ""         TextColor       =   &h000000         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   178         Underline       =   ""         UseFocusRing    =   True         Visible         =   True         Width           =   590      End      Begin Label StaticText11         AutoDeactivate  =   True         Bold            =   ""         DataField       =   ""         DataSource      =   ""         Enabled         =   True         Height          =   20         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         Italic          =   ""         Left            =   50         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   True         Multiline       =   ""         Scope           =   0         Selectable      =   False         TabIndex        =   8         TabPanelIndex   =   1         Text            =   "#kResults"         TextAlign       =   2         TextColor       =   &h000000         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   216         Transparent     =   False         Underline       =   ""         Visible         =   True         Width           =   100      End      Begin PushButton PushButton4         AutoDeactivate  =   True         Bold            =   ""         ButtonStyle     =   0         Cancel          =   ""         Caption         =   "#kBrowseForZipFile"         Default         =   ""         Enabled         =   True         Height          =   20         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         Italic          =   ""         Left            =   33         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   True         Scope           =   0         TabIndex        =   0         TabPanelIndex   =   3         TabStop         =   True         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   123         Underline       =   ""         Visible         =   True         Width           =   182      End      Begin Label Label1         AutoDeactivate  =   True         Bold            =   ""         DataField       =   ""         DataSource      =   ""         Enabled         =   True         Height          =   53         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         Italic          =   ""         Left            =   37         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   True         LockTop         =   True         Multiline       =   True         Scope           =   0         Selectable      =   False         TabIndex        =   1         TabPanelIndex   =   3         Text            =   "#kInstallFromLocalZip"         TextAlign       =   0         TextColor       =   &h000000         TextFont        =   "System"         TextSize        =   10         TextUnit        =   0         Top             =   58         Transparent     =   False         Underline       =   ""         Visible         =   True         Width           =   726      End      Begin Rectangle Rectangle1         AutoDeactivate  =   True         BorderWidth     =   1         BottomRightColor=   "&cBBBBBB"         Enabled         =   True         FillColor       =   "&cCCCCCC"         Height          =   565         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         Left            =   33         LockBottom      =   True         LockedInPosition=   False         LockLeft        =   True         LockRight       =   True         LockTop         =   True         Scope           =   0         TabIndex        =   2         TabPanelIndex   =   3         Top             =   155         TopLeftColor    =   "&cBBBBBB"         Visible         =   True         Width           =   726         Begin Label Label2            AutoDeactivate  =   True            Bold            =   ""            DataField       =   ""            DataSource      =   ""            Enabled         =   False            Height          =   61            HelpTag         =   ""            Index           =   -2147483648            InitialParent   =   "Rectangle1"            Italic          =   ""            Left            =   33            LockBottom      =   ""            LockedInPosition=   False            LockLeft        =   True            LockRight       =   True            LockTop         =   True            Multiline       =   ""            Scope           =   0            Selectable      =   False            TabIndex        =   0            TabPanelIndex   =   3            Text            =   "#kDropZipFileHere"            TextAlign       =   1            TextColor       =   "&cAAAAAA"            TextFont        =   "System"            TextSize        =   30            TextUnit        =   0            Top             =   418            Transparent     =   True            Underline       =   ""            Visible         =   True            Width           =   726         End      End      Begin Label StaticText1         AutoDeactivate  =   True         Bold            =   ""         DataField       =   ""         DataSource      =   ""         Enabled         =   True         Height          =   20         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         Italic          =   ""         Left            =   50         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   True         Multiline       =   ""         Scope           =   0         Selectable      =   False         TabIndex        =   1         TabPanelIndex   =   1         Text            =   "#kSearch"         TextAlign       =   2         TextColor       =   &h000000         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   179         Transparent     =   False         Underline       =   ""         Visible         =   True         Width           =   100      End      Begin Listbox lstTextResults         AutoDeactivate  =   True         AutoHideScrollbars=   True         Bold            =   ""         Border          =   True         ColumnCount     =   3         ColumnsResizable=   ""         ColumnWidths    =   "60%,25%"         DataField       =   ""         DataSource      =   ""         DefaultRowHeight=   -1         Enabled         =   True         EnableDrag      =   ""         EnableDragReorder=   ""         GridLinesHorizontal=   0         GridLinesVertical=   0         HasHeading      =   True         HeadingIndex    =   -1         Height          =   162         HelpTag         =   ""         Hierarchical    =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         InitialValue    =   "#kTitle	#kAirports	#kFileSize"         Italic          =   ""         Left            =   167         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   True         RequiresSelection=   ""         Scope           =   0         ScrollbarHorizontal=   ""         ScrollBarVertical=   True         SelectionType   =   0         TabIndex        =   9         TabPanelIndex   =   1         TabStop         =   True         TextFont        =   "System"         TextSize        =   11         TextUnit        =   0         Top             =   216         Underline       =   ""         UseFocusRing    =   True         Visible         =   True         Width           =   590         _ScrollWidth    =   -1      End      Begin Label Label3         AutoDeactivate  =   True         Bold            =   ""         DataField       =   ""         DataSource      =   ""         Enabled         =   True         Height          =   109         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         Italic          =   ""         Left            =   37         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   True         LockTop         =   True         Multiline       =   True         Scope           =   0         Selectable      =   False         TabIndex        =   10         TabPanelIndex   =   1         Text            =   "#kInstallFromOnlineTextSearch"         TextAlign       =   0         TextColor       =   &h000000         TextFont        =   "System"         TextSize        =   10         TextUnit        =   0         Top             =   58         Transparent     =   False         Underline       =   ""         Visible         =   True         Width           =   491      End      Begin Canvas Canvas2         AcceptFocus     =   ""         AcceptTabs      =   ""         AutoDeactivate  =   True         Backdrop        =   1975463092         DoubleBuffer    =   False         Enabled         =   True         EraseBackground =   True         Height          =   67         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         Left            =   556         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   False         LockRight       =   True         LockTop         =   True         Scope           =   0         TabIndex        =   0         TabPanelIndex   =   2         TabStop         =   True         Top             =   58         UseFocusRing    =   False         Visible         =   True         Width           =   201      End      Begin Label Label4         AutoDeactivate  =   True         Bold            =   ""         DataField       =   ""         DataSource      =   ""         Enabled         =   True         Height          =   83         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         Italic          =   ""         Left            =   37         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   True         LockTop         =   True         Multiline       =   True         Scope           =   0         Selectable      =   False         TabIndex        =   1         TabPanelIndex   =   2         Text            =   "#kInstallFromOnlineLocationSearch"         TextAlign       =   0         TextColor       =   &h000000         TextFont        =   "System"         TextSize        =   10         TextUnit        =   0         Top             =   58         Transparent     =   False         Underline       =   ""         Visible         =   True         Width           =   494      End      Begin Canvas cnvMap         AcceptFocus     =   ""         AcceptTabs      =   ""         AutoDeactivate  =   False         Backdrop        =   ""         DoubleBuffer    =   False         Enabled         =   True         EraseBackground =   False         Height          =   360         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         Left            =   37         LockBottom      =   False         LockedInPosition=   False         LockLeft        =   ""         LockRight       =   ""         LockTop         =   ""         Scope           =   0         TabIndex        =   2         TabPanelIndex   =   2         TabStop         =   True         Top             =   187         UseFocusRing    =   False         Visible         =   True         Width           =   720      End      Begin Label StaticText12         AutoDeactivate  =   True         Bold            =   ""         DataField       =   ""         DataSource      =   ""         Enabled         =   True         Height          =   20         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         Italic          =   ""         Left            =   37         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   True         Multiline       =   ""         Scope           =   0         Selectable      =   False         TabIndex        =   3         TabPanelIndex   =   2         Text            =   "#kSearchRadius"         TextAlign       =   2         TextColor       =   &h000000         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   154         Transparent     =   False         Underline       =   ""         Visible         =   True         Width           =   130      End      Begin Listbox Listbox2         AutoDeactivate  =   True         AutoHideScrollbars=   True         Bold            =   ""         Border          =   True         ColumnCount     =   1         ColumnsResizable=   ""         ColumnWidths    =   ""         DataField       =   ""         DataSource      =   ""         DefaultRowHeight=   -1         Enabled         =   True         EnableDrag      =   ""         EnableDragReorder=   ""         GridLinesHorizontal=   0         GridLinesVertical=   0         HasHeading      =   ""         HeadingIndex    =   -1         Height          =   162         HelpTag         =   ""         Hierarchical    =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         InitialValue    =   ""         Italic          =   ""         Left            =   179         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   True         RequiresSelection=   ""         Scope           =   0         ScrollbarHorizontal=   ""         ScrollBarVertical=   True         SelectionType   =   0         TabIndex        =   4         TabPanelIndex   =   2         TabStop         =   True         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   559         Underline       =   ""         UseFocusRing    =   True         Visible         =   True         Width           =   434         _ScrollWidth    =   -1      End      Begin Label StaticText111         AutoDeactivate  =   True         Bold            =   ""         DataField       =   ""         DataSource      =   ""         Enabled         =   True         Height          =   20         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         Italic          =   ""         Left            =   37         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   True         Multiline       =   ""         Scope           =   0         Selectable      =   False         TabIndex        =   5         TabPanelIndex   =   2         Text            =   "#kResults"         TextAlign       =   2         TextColor       =   &h000000         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   559         Transparent     =   False         Underline       =   ""         Visible         =   True         Width           =   130      End      Begin PopupMenu PopupMenu1         AutoDeactivate  =   True         Bold            =   ""         DataField       =   ""         DataSource      =   ""         Enabled         =   True         Height          =   20         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         InitialValue    =   "50nm\r100nm\r200nm\r500nm"         Italic          =   ""         Left            =   179         ListIndex       =   0         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   True         Scope           =   0         TabIndex        =   6         TabPanelIndex   =   2         TabStop         =   True         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   153         Underline       =   ""         Visible         =   False         Width           =   122      End      Begin Canvas Canvas3         AcceptFocus     =   ""         AcceptTabs      =   ""         AutoDeactivate  =   True         Backdrop        =   1975463092         DoubleBuffer    =   False         Enabled         =   True         EraseBackground =   True         Height          =   67         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         Left            =   556         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   False         LockRight       =   True         LockTop         =   True         Scope           =   0         TabIndex        =   11         TabPanelIndex   =   1         TabStop         =   True         Top             =   58         UseFocusRing    =   False         Visible         =   True         Width           =   201      End      Begin ProgressBar prgBarFile         AutoDeactivate  =   True         Enabled         =   True         Height          =   20         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         Left            =   320         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   True         Maximum         =   100         Scope           =   0         TabPanelIndex   =   1         Top             =   698         Value           =   0         Visible         =   True         Width           =   437      End      Begin HTMLViewer htmlDescription         AutoDeactivate  =   True         Enabled         =   True         Height          =   296         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "TabPanel1"         Left            =   167         LockBottom      =   True         LockedInPosition=   False         LockLeft        =   True         LockRight       =   True         LockTop         =   True         Scope           =   0         TabIndex        =   0         TabIndex        =   0         TabPanelIndex   =   1         TabStop         =   True         Top             =   390         Visible         =   True         Width           =   590      End   End   Begin PushButton PushButton5      AutoDeactivate  =   True      Bold            =   ""      ButtonStyle     =   0      Cancel          =   ""      Caption         =   "Parse Remote XML"      Default         =   ""      Enabled         =   True      Height          =   29      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   426      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   False      Scope           =   0      TabIndex        =   15      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   781      Underline       =   ""      Visible         =   True      Width           =   185   End   Begin HTTPSocket sockManifest      Address         =   ""      BytesAvailable  =   ""      BytesLeftToSend =   ""      Height          =   32      Index           =   -2147483648      IsConnected     =   0      Left            =   823      LockedInPosition=   False      Port            =   80      Scope           =   0      TabPanelIndex   =   0      Top             =   44      Width           =   32      yield           =   0   End   Begin Thread Thread1      Height          =   32      Index           =   -2147483648      Left            =   823      LockedInPosition=   False      Priority        =   5      Scope           =   0      StackSize       =   0      TabPanelIndex   =   0      Top             =   114      Width           =   32   EndEnd#tag EndWindow#tag WindowCode	#tag Event		Sub Close()		  if (chkRememberLogin.value) then		    dim encryptedPassword as string = eCryptEncode(Encrypt(txtPassword.text, "wibble", 0), 0, 255)		    		    msgbox(Decrypt(eCryptDecode(encryptedPassword, 0, 255), "wibble", 0))		  end if		  		End Sub	#tag EndEvent	#tag Event		Sub Open()		  ' Check package list, will download a new one if it's out of date		  checkAndUpdatePackageList()		  		  ' Set up map		  pMap = new Picture(imgWorldmap.width / App.kMapZoomFactor, imgWorldmap.height / App.kMapZoomFactor, 32)		  dim g as Graphics = pMap.graphics		  g.drawPicture(imgWorldmap, 0, 0, g.width, g.height, 0, 0, imgWorldmap.width, imgWorldmap.height)		  		  		End Sub	#tag EndEvent	#tag MenuHandler		Function FileClose() As Boolean Handles FileClose.Action			me.close			Return True					End Function	#tag EndMenuHandler	#tag Method, Flags = &h0		Sub addSceneryPackageFromZip(optional folderItem as FolderItem = nil)		  dim dialog as SelectFolderDialog		  		  dim zipType As new FileType		  zipType.Name = "application/zip"		  zipType.MacType = "ZIP "		  zipType.Extensions = "zip"		  		  if (folderItem = nil) then		    folderItem = getOpenFolderItem(zipType)		    		    if (folderItem = nil) then		      return		    end if		  end if		  		  dim sourceFolderItem as FolderItem = Addon.extractZipToTemporaryLocation(folderItem)		  if sourceFolderItem = nil then return		  sourceFolderItem = AddOn.searchForAddon(sourceFolderItem, "CustomSceneryPackage")		  		  if sourceFolderItem = nil then		    dim result as Integer = App.displayMessage(kErrorNotValidCompressedSceneryPackage, "", MessageDialog.GraphicCaution, App.kOk, "", "", me)		  else		    CustomSceneryPackage.install(sourceFolderItem)		    wndMain.scanXPlaneFolder()		    return		  end if		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub checkAndUpdatePackageList()		  dim sql as String = "SELECT value FROM info WHERE key = '" + App.kDBInfoKeyLastDownload + "'"		  dim rs as recordSet		  		  rs = dbMain.SQLSelect(sql)		  		  if (rs <> nil and rs.Field("value") <> nil and rs.Field("value").StringValue <> "") then		    dim lastDownloadDate as new Date()		    		    lastDownloadDate.SQLDateTime = rs.Field("value")		    		    dim now as new Date()		    		    if (now.totalSeconds - lastDownloadDate.totalSeconds < 10) then		      return		    end if		    		    // We're about to re-download, clear any last download record		    sql = "DELETE FROM info WHERE key = '" + App.kDBInfoKeyLastDownload + "'"		    dbMain.SQLExecute(sql)		  end if		  		  // If we've got here then we need to download the package list		  'sockManifest.get(App.kURLOrgManifest, getTemporaryFolderItem())		  parseManifest(SpecialFolder.Desktop.child("X-Plane").child("XAddonManager").child("doc").child("PackageList.xml"))		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub listPackages(searchText as String)		  dim sql as String		  dim rs as recordSet		  		  searchText = escapeSQLData(searchText)		  		  sql = "SELECT id, name, airport_codes, file_size FROM scenery_package WHERE name LIKE '%" +searchText + "%'"		  sql = sql + " OR airport_codes LIKE '%" +searchText + "%'"		  sql = sql + " OR description LIKE '%" + searchText + "%'"		  		  rs = dbMain.SQLSelect(sql)		  		  if (rs <> nil) then		    populateListBoxFromRecordSet(lstTextResults, rs, true)		    lstTextResults.scrollPosition = 0		  end if		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub parseManifest(file as FolderItem)		  dim now as Date = new Date()		  dim sql as String = "INSERT INTO info (key, value) VALUES ('" + App.kDBInfoKeyLastDownload + "', '" + now.SQLDateTime + "')"		  		  dbMain.SQLExecute(sql)		  		  if dbMain.Error() then		    MsgBox(dbMain.ErrorMessage())		    return		  end if		  		  dbMain.Commit()		  		  sql = "DELETE from scenery_package"		  		  dbMain.SQLExecute(sql)		  		  if dbMain.Error() then		    MsgBox(dbMain.ErrorMessage())		    return		  end if		  		  dbMain.Commit()		  		  dim xdoc as XmlDocument		  dim xmlNode as XMLNode		  dim resultNodes as XMLNodeList		  dim i as integer		  dim id, name, creation_date, last_update_date, airport_codes, description, download_url, file_size as String		  dim date as Date = new Date()		  dim result as Boolean		  		  try		    xdoc = new XmlDocument		    xdoc.PreserveWhitespace = False		    xdoc.loadXml(file)		    		    dim sceneryPackages as XMLNodeList = xdoc.XQL("//SceneryPackage")		    		    for i = 0 to sceneryPackages.Length - 1		      xmlNode = sceneryPackages.Item(i)		      sql = "INSERT INTO scenery_package (id, name, creation_date, last_updated_date, airport_codes, description, download_url, file_size) VALUES ("		      		      sql = sql + "'" + xmlNode.GetAttribute("id") + "',"		      		      resultNodes  = xmlNode.XQL("Name")		      sql = sql + "'" + escapeSQLData(unencodeHTML(resultNodes.Item(0).FirstChild.value)) + "',"		      		      resultNodes  = xmlNode.XQL("CreationDate")		      result = ParseDate(resultNodes.Item(0).FirstChild.value, date)		      sql = sql + "'" + date.SQLDateTime + "',"		      		      resultNodes  = xmlNode.XQL("LastUpdateDate")		      result = ParseDate(resultNodes.Item(0).FirstChild.value, date)		      sql = sql + "'" + date.SQLDateTime + "',"		      		      resultNodes  = xmlNode.XQL("AirportCodes")		      sql = sql + "'" + escapeSQLData(resultNodes.Item(0).FirstChild.value) + "',"		      		      resultNodes  = xmlNode.XQL("Description")		      sql = sql + "'" + escapeSQLData(Utilities.convertBBtoHTML(resultNodes.Item(0).FirstChild.value)) + "',"		      		      resultNodes  = xmlNode.XQL("DownloadURL")		      sql = sql + "'" + escapeSQLData(resultNodes.Item(0).FirstChild.value) + "',"		      		      resultNodes  = xmlNode.XQL("FileSize")		      sql = sql + "'" + escapeSQLData(resultNodes.Item(0).FirstChild.value) + "'"		      		      sql = sql + ")"		      		      dbMain.SQLExecute(sql)		      		      if dbMain.Error() then		        MsgBox(dbMain.ErrorMessage())		        MsgBox(sql)		        return		      end if		    next i		    		    if dbMain.Error() then		      MsgBox(dbMain.ErrorMessage())		      return		    end if		    		    dbMain.Commit()		    		  catch ex as RuntimeException		    msgbox(ex.Message)		  end try		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub SelectPackage(listIndex as integer)		  dim sql as String		  dim rs as recordSet		  		  if (listIndex > -1) then		    sql = "SELECT description FROM scenery_package WHERE id = '" +str(listIndex) + "'"		    		    rs = dbMain.SQLSelect(sql)		    		    if (rs <> nil) then		      ' Can't use getTemporaryFolderItem here because there's a bug in it where the file handle is left open on Linux.		      ' So instead we create our own randomly-named file inside the system temporary folder		      dim r as Random = new Random		      dim temporaryFile as FolderItem = SpecialFolder.Temporary.child(str(r.InRange(10000000, 99999999)))		      dim tos as TextOutputStream = TextOutputStream.create(temporaryFile)		      		      tos.write("<html><head></head><body style='font-family:sans-serif;font-size:9pt;'>")		      tos.write(rs.field("description"))		      tos.write("</body></html>")		      tos.close		      		      pInitialLoad = true		      htmlDescription.loadPage(temporaryFile)		    end if		  else		    		  end if		End Sub	#tag EndMethod	#tag Property, Flags = &h0		pInitialLoad As Boolean = false	#tag EndProperty	#tag Property, Flags = &h0		pMap As Picture	#tag EndProperty	#tag Constant, Name = kAirports, Type = String, Dynamic = True, Default = \"Airports", Scope = Public	#tag EndConstant	#tag Constant, Name = kBrowseForZipFile, Type = String, Dynamic = True, Default = \"Browse for Zip File\xE2\x80\xA6", Scope = Public	#tag EndConstant	#tag Constant, Name = kDropZipFileHere, Type = String, Dynamic = True, Default = \"Drop Zip File Here", Scope = Public	#tag EndConstant	#tag Constant, Name = kErrorNotValidCompressedSceneryPackage, Type = String, Dynamic = True, Default = \"You did not select a compressed scenery package.  Please try again.", Scope = Public		#Tag Instance, Platform = Any, Language = ca, Definition  = \"No heu seleccionat un paquet d\'escenari comprimit. Torneu-ho a provar."		#Tag Instance, Platform = Any, Language = it, Definition  = \"Non hai selezionato un archivio compresso dello scenario. Per favore riprova."		#Tag Instance, Platform = Any, Language = fr, Definition  = \"Vous n\'avez pas s\xC3\xA9lectionner une archive contenant une sc\xC3\xA8ne. Recommencez SVP."		#Tag Instance, Platform = Any, Language = de, Definition  = \"Sie haben kein komprimiertes Scenery Packet ausgew\xC3\xA4hlt\x2C versuchen sie es bitte erneut."		#Tag Instance, Platform = Any, Language = es, Definition  = \"No has seleccionado un paquete de escenario comprimido. Por favor\x2C intenta de nuevo."	#tag EndConstant	#tag Constant, Name = kFileSize, Type = String, Dynamic = True, Default = \"File Size", Scope = Public	#tag EndConstant	#tag Constant, Name = kInstallFromLocalZip, Type = String, Dynamic = True, Default = \"Use this panel to install a scenery package from a zip file you have downloaded from the Internet.  Either click the \'Browse for Zip File\xE2\x80\xA6\' button to choose a file\x2C or drag the file into the area below.", Scope = Public	#tag EndConstant	#tag Constant, Name = kInstallFromOnlineLocationSearch, Type = String, Dynamic = True, Default = \"Use this panel to install a scenery package from those available at X-Plane.org near a location on the map.  Click on the map to perform the search.  You can search and browse at your leisure\x2C but to download a package you must register on the site and log in inside XAddonManager.\r\rIf you don\'t already have an account\x2C click the X-Plane.org logo to register\x2C it\'s free!", Scope = Public	#tag EndConstant	#tag Constant, Name = kInstallFromOnlineTextSearch, Type = String, Dynamic = True, Default = \"Use this panel to install a scenery package from those available at X-Plane.org by entering a search term.  You can search and browse at your leisure\x2C but to download a package you must register on the site and log in inside XAddonManager.\r\rIf you don\'t already have an account\x2C click the X-Plane.org logo to register\x2C it\'s free!", Scope = Public	#tag EndConstant	#tag Constant, Name = kLastUpdated, Type = String, Dynamic = True, Default = \"Last Updated", Scope = Public	#tag EndConstant	#tag Constant, Name = kLocalZipInstall, Type = String, Dynamic = True, Default = \"Local Zip Install", Scope = Public	#tag EndConstant	#tag Constant, Name = kOnlineLocationSearch, Type = String, Dynamic = True, Default = \"Online Location Search", Scope = Public	#tag EndConstant	#tag Constant, Name = kOnlineTextSearch, Type = String, Dynamic = True, Default = \"Online Text Search", Scope = Public	#tag EndConstant	#tag Constant, Name = kResults, Type = String, Dynamic = True, Default = \"Results:", Scope = Public	#tag EndConstant	#tag Constant, Name = kSearch, Type = String, Dynamic = True, Default = \"Search:", Scope = Public	#tag EndConstant	#tag Constant, Name = kSearchRadius, Type = String, Dynamic = True, Default = \"Search Radius:", Scope = Public	#tag EndConstant	#tag Constant, Name = kTitle, Type = String, Dynamic = True, Default = \"Title", Scope = Public	#tag EndConstant	#tag Constant, Name = kWindowTitle, Type = String, Dynamic = True, Default = \"Install Scenery Package", Scope = Public	#tag EndConstant#tag EndWindowCode#tag Events PushButton2	#tag Event		Sub Action()		  dim form as Dictionary = new Dictionary		  		  form.value("username") = txtUsername.text		  form.value("password") = txtPassword.text		  		  // setup the socket to POST the form		  loginSocket.setFormData(form)		  loginSocket.SetRequestHeader("User-Agent", "XAddonManager (like iPhone; en-us)")		  loginSocket.post("http://forums.x-plane.org/index.php?app=core&module=global&section=login&do=process")		  		End Sub	#tag EndEvent#tag EndEvents#tag Events loginSocket	#tag Event		Sub PageReceived(url as string, httpStatus as integer, headers as internetHeaders, content as string)		  loginHTMLViewer.LoadPage(content, new FolderItem)		End Sub	#tag EndEvent	#tag Event		Sub HeadersReceived(headers as internetHeaders, httpStatus as integer)		  msgbox("Headers Received, status: " + str(httpStatus))		  		End Sub	#tag EndEvent	#tag Event		Sub Connected()		  msgbox("Connected")		End Sub	#tag EndEvent#tag EndEvents#tag Events txtAptCode	#tag Event		Sub TextChange()		  listPackages(me.text)		  		  // This stuff below searches the local apt.dat file to find the lat / long of an airport. Might be useful later…		  		  'if App.pXPlaneFolder.pAirportData.pAirports.hasKey(txtAptCode.text) then		  'dim airport as Airport = App.pXPlaneFolder.pAirportData.pAirports.value(txtAptCode.text)		  'txtLat.text = str(airport.pLatLong.pLatitude)		  'txtLong.text = str(airport.pLatLong.pLongitude)		  'else		  'txtLat.text = "Not Found"		  'txtLong.text = "Not Found"		  'end if		End Sub	#tag EndEvent#tag EndEvents#tag Events PushButton4	#tag Event		Sub Action()		  addSceneryPackageFromZip()		End Sub	#tag EndEvent#tag EndEvents#tag Events Rectangle1	#tag Event		Sub Open()		  me.AcceptFileDrop("application/zip")		End Sub	#tag EndEvent	#tag Event		Sub DropObject(obj As DragItem, action As Integer)		  me.fillColor = &cCCCCCC		  		  if (obj.FolderItemAvailable() and obj.FolderItem.type = "application/zip") then		    addSceneryPackageFromZip(obj.FolderItem)		  end if		End Sub	#tag EndEvent	#tag Event		Function DragEnter(obj As DragItem, action As Integer) As Boolean		  if (obj.FolderItemAvailable() and obj.FolderItem.type = "application/zip") then		    me.fillColor = &cBBCCBB		    me.refresh		    return false		  else		    return true		  end if		End Function	#tag EndEvent	#tag Event		Sub DragExit(obj As DragItem, action As Integer)		  me.fillColor = &cCCCCCC		  me.refresh		  		End Sub	#tag EndEvent#tag EndEvents#tag Events lstTextResults	#tag Event		Sub Change()		  if (me.listIndex > -1) then		    selectPackage(me.rowTag(me.listIndex))		  else		    selectPackage(-1)		  end if		End Sub	#tag EndEvent#tag EndEvents#tag Events Canvas2	#tag Event		Sub Open()		  me.mousecursor = System.Cursors.FingerPointer		End Sub	#tag EndEvent	#tag Event		Function MouseDown(X As Integer, Y As Integer) As Boolean		  showURL(App.kURLOrgRegister)		End Function	#tag EndEvent#tag EndEvents#tag Events cnvMap	#tag Event		Function MouseDown(X As Integer, Y As Integer) As Boolean		  'selectNearestPackage(x, y)		  return false		End Function	#tag EndEvent	#tag Event		Sub MouseMove(X As Integer, Y As Integer)		  dim customSceneryPackage as CustomSceneryPackage		  'customSceneryPackage = getPackageUnderCursor(x, y)		  		  'moveZoom(x, y)		  		  if (customSceneryPackage <> nil) then		    'fldTooltip.text = customSceneryPackage.pName		    'fldTooltip.visible = true		  else		    'fldTooltip.visible = false		  end if		  		  		End Sub	#tag EndEvent	#tag Event		Sub MouseExit()		  'fldTooltip.visible = false		  'cnvZoom.visible = false		End Sub	#tag EndEvent	#tag Event		Sub MouseEnter()		  'cnvZoom.visible = true		End Sub	#tag EndEvent	#tag Event		Sub Paint(g As Graphics)		  // Copy the off-screen image to the map canvas.		  g.drawPicture(pMap, 0, 0, me.width, me.height, 0, 0, pMap.width, pMap.height)		End Sub	#tag EndEvent#tag EndEvents#tag Events Canvas3	#tag Event		Sub Open()		  me.mousecursor = System.Cursors.FingerPointer		End Sub	#tag EndEvent	#tag Event		Function MouseDown(X As Integer, Y As Integer) As Boolean		  showURL(App.kURLOrgRegister)		End Function	#tag EndEvent#tag EndEvents#tag Events htmlDescription	#tag Event		Function CancelLoad(URL as String) As Boolean		  // Load URLs in user's web browser		  if not pInitialLoad then		    ShowURL(URL)		    return true		  else		    pInitialLoad = false		    return false		  end if		End Function	#tag EndEvent#tag EndEvents#tag Events sockManifest	#tag Event		Sub ReceiveProgress(bytesReceived as integer, totalBytes as integer, newData as string)		  prgBarFile.maximum = totalBytes		  prgBarFile.value = bytesReceived		  		End Sub	#tag EndEvent	#tag Event		Sub DownloadComplete(url as string, httpStatus as integer, headers as internetHeaders, file as folderItem)		  if (httpStatus = 200) then		    parseManifest(file)		  else		    'showMessage(txtLocalScanBodyText2, kErrorManifest + " (4)")		    'prgwLocalScan2.visible = false		  end if		End Sub	#tag EndEvent#tag EndEvents